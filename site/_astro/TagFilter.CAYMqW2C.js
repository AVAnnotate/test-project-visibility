import{j as e}from"./jsx-runtime.B6N9iRLn.js";import{u as X}from"./index.BDWyZ8Gq.js";import{r,R as y}from"./index.DNi1g-pO.js";import{c as T,t as q,b as J,d as Q,$ as Y}from"./store.aycOQVLs.js";import{F as z}from"./XMarkIcon.2w2G2u9O.js";import{u as Z,a as ee,I as te,G as se,$ as ae,b as le}from"./label.BDZJ2zrY.js";import{l as re,T as oe,w as ne,j as ie,r as ce,o as P,p as de,a as me,A as ge,R as ue}from"./popover.KsDTL0Vr.js";import{p as xe}from"./use-server-handoff-complete.BXIqNzS3.js";import{W as fe,o as j,D as he,H as pe}from"./use-sync-refs.D0KZ01Xc.js";import"./index.iExtbhlT.js";function be({title:t,titleId:l,...d},s){return r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:s,"aria-labelledby":l},d),t?r.createElement("title",{id:l},t):null,r.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 13.5V3.75m0 9.75a1.5 1.5 0 0 1 0 3m0-3a1.5 1.5 0 0 0 0 3m0 3.75V16.5m12-3V3.75m0 9.75a1.5 1.5 0 0 1 0 3m0-3a1.5 1.5 0 0 0 0 3m0 3.75V16.5m-6-9V3.75m0 3.75a1.5 1.5 0 0 1 0 3m0-3a1.5 1.5 0 0 0 0 3m0 9.75V10.5"}))}const je=r.forwardRef(be);function we({title:t,titleId:l,...d},s){return r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:s,"aria-labelledby":l},d),t?r.createElement("title",{id:l},t):null,r.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m4.5 12.75 6 6 9-13.5"}))}const N=r.forwardRef(we);let ye="span";function ke(t,l){let d=r.useId(),s=Z(),k=ee(),{id:m=s||`headlessui-checkbox-${d}`,disabled:o=k||!1,autoFocus:a=!1,checked:x,defaultChecked:n,onChange:g,name:i,value:u,form:v,indeterminate:b=!1,...A}=t,f=re(n),[h,p]=oe(x,g,f??!1),D=te(),V=se(),I=xe(),[$,C]=r.useState(!1),F=j(()=>{C(!0),p?.(!h),I.nextFrame(()=>{C(!1)})}),M=j(c=>{if(ce(c.currentTarget))return c.preventDefault();c.preventDefault(),F()}),O=j(c=>{c.key===P.Space?(c.preventDefault(),F()):c.key===P.Enter&&de(c.currentTarget)}),G=j(c=>c.preventDefault()),{isFocusVisible:E,focusProps:H}=ae({autoFocus:a}),{isHovered:R,hoverProps:B}=le({isDisabled:o}),{pressed:S,pressProps:K}=ne({disabled:o}),W=he({ref:l,id:m,role:"checkbox","aria-checked":b?"mixed":h?"true":"false","aria-labelledby":D,"aria-describedby":V,"aria-disabled":o?!0:void 0,indeterminate:b?"true":void 0,tabIndex:o?void 0:0,onKeyUp:o?void 0:O,onKeyPress:o?void 0:G,onClick:o?void 0:M},H,B,K),_=r.useMemo(()=>({checked:h,disabled:o,hover:R,focus:E,active:S,indeterminate:b,changing:$,autofocus:a}),[h,b,o,R,E,S,$,a]),U=r.useCallback(()=>{if(f!==void 0)return p?.(f)},[p,f]);return y.createElement(y.Fragment,null,i!=null&&y.createElement(ie,{disabled:o,data:{[i]:u||"on"},overrides:{type:"checkbox",checked:h},form:v,onReset:U}),pe({ourProps:W,theirProps:A,slot:_,defaultTag:ye,name:"Checkbox"}))}let L=fe(ke);const w=t=>/^#[0-9A-F]{6}[0-9a-f]{0,2}$/i.test(t),ve=t=>{const l=e.jsxs(e.Fragment,{children:[t.icon&&e.jsx(t.icon,{className:"size-4"}),e.jsx("span",{className:"font-semibold",children:t.tag}),t.count?e.jsx("span",{children:t.count}):null]});return t.onClick?e.jsx("button",{className:`${w(t.color)?"":`bg-${t.color}`} tag-pill rounded-full text-xs flex flex-row justify-center px-3 py-1.5 gap-1 cursor-default ${t.className||""}`,style:{backgroundColor:w(t.color)?t.color:void 0},onClick:t.onClick,children:l}):e.jsx("div",{className:`${w(t.color)?"":`bg-${t.color}`} tag-pill rounded-full text-xs flex flex-row justify-center px-3 py-1.5 gap-1 cursor-default ${t.className||""}`,style:{backgroundColor:w(t.color)?t.color:void 0},onClick:t.onClick,children:l})},Le=t=>{const{playerId:l}=t,d=X(Y),s=r.useMemo(()=>d[l],[d,l]),k=t.projectData.data.project.tags.tagGroups,m=r.useMemo(()=>{const a={};return(s.sets.length>0?t.annotationSets.filter(n=>s.sets.includes(n.id)):t.annotationSets).forEach(n=>{n?.data.annotations.forEach(g=>{g.tags&&g.tags.length&&g.tags.forEach(i=>{const u=i.category.toLowerCase();a[u]||={tags:[],color:k.find(v=>v.category.toLowerCase()===u)?.color||"#FFF"},a[u].tags.includes(i.tag)||(a[u].tags.push(i.tag),a[u].tags.sort())})})}),a},[s.sets]),o=Object.keys(m);return e.jsxs(me,{children:[e.jsxs(ge,{className:"bg-white rounded-lg flex flex-row justify-center items-center gap-2 px-2 py-1.5 data-[open]:bg-blue-hover font-semibold",children:[e.jsx(je,{className:"size-4"}),e.jsx("span",{children:"Filter"}),(s.tags.length>0||s.sets.length>0)&&e.jsx("div",{className:"rounded-2xl px-1.5 py-0.5 flex items-center justify-center text-white bg-primary text-xs",children:s.tags.length+s.sets.length})]}),e.jsxs(ue,{anchor:"bottom end",className:"flex flex-col w-[400px] bg-white drop-shadow-lg p-6 rounded-md mt-4",children:[e.jsx("p",{className:"text-md font-semibold mb-4",children:"Filters"}),e.jsx("div",{className:"flex flex-row justify-between w-full pb-2",children:t.annotationSets.length>1&&e.jsxs("div",{className:"w-full pb-2",children:[e.jsxs("div",{className:"flex flex-row justify-between w-full pb-2",children:[e.jsx("p",{className:"text-sm font-semibold",children:"Annotation Sets"}),s.sets.length>0&&e.jsxs("div",{className:"bg-primary rounded-lg flex items-center justify-center gap-2 py-1 px-2 text-white cursor-default text-xs font-semibold",children:[e.jsx("p",{children:`${s.sets.length} filter${s.sets.length>1?"s":""} applied`}),e.jsx(z,{className:"size-4 text-white hover:scale-105 cursor-pointer",onClick:()=>T("sets",l)})]})]}),t.annotationSets.map(a=>e.jsx("div",{className:"block",children:e.jsxs("div",{className:"flex flex-row gap-3 py-1",children:[e.jsx(L,{checked:s.sets&&s.sets.includes(a.id),onChange:()=>{q(a.id,l)},className:"min-w-4 group size-4 bg-white rounded-sm data-[checked]:bg-primary p-0.5 ring-1 ring-gray-300 ring-inset data-[checked]:ring-primary",children:e.jsx(N,{className:"hidden size-3 group-data-[checked]:block text-white"})}),e.jsx("p",{className:"grow-0 capitalize font-semibold text-xs",children:a.data.set.replaceAll("_","")})]})},a.id))]})}),e.jsxs("div",{className:"flex flex-row justify-between w-full pb-2",children:[e.jsx("p",{className:"text-sm font-semibold",children:"Tags"}),s.tags.length>0&&e.jsxs("div",{className:"bg-primary rounded-lg flex items-center justify-center gap-2 py-1 px-2 text-white cursor-default text-xs font-semibold",children:[e.jsx("p",{children:`${s.tags.length} filter${s.tags.length>1?"s":""} applied`}),e.jsx(z,{className:"size-4 text-white hover:scale-105 cursor-pointer",onClick:()=>T("tags",l)})]})]}),s&&o.map((a,x)=>e.jsxs(y.Fragment,{children:[x>0?e.jsx("div",{className:"h-[1px] bg-gray-200 w-full my-3"}):null,e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("div",{className:"flex flex-row gap-3 py-1",children:[e.jsx(L,{checked:s.tags&&s.tags.filter(n=>n.category.toLowerCase()===a.toLowerCase()).length===m[a].tags.length,onChange:()=>{J(a,m,l)},className:"group size-4 bg-white rounded-sm data-[checked]:bg-primary p-0.5 ring-1 ring-gray-300 ring-inset data-[checked]:ring-primary",children:e.jsx(N,{className:"hidden size-3 group-data-[checked]:block text-white"})}),e.jsx("p",{className:"capitalize font-semibold text-xs",children:a.replaceAll("_","")})]}),e.jsx("div",{className:"flex flex-row gap-2 flex-wrap",children:m[a].tags.map((n,g)=>e.jsx(ve,{color:m[a].color,tag:n,icon:s.tags&&s.tags?.findIndex(i=>i.category==a&&i.tag==n)!==-1?N:void 0,className:s.tags&&s.tags?.findIndex(i=>i.category===a&&i.tag===n)!==-1?"outline outline-1 outline-black":"",onClick:()=>{Q({category:a,tag:n},l)}},g))})]},x)]},x))]})]})};export{Le as default};
